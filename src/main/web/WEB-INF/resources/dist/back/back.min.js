!function(){var a=angular.module("backApp",["backServices","ui.bootstrap","ngSanitize","pascalprecht.translate","ngCookies","ngResource","frontApp"]);a.config(function(a){var b;angular.injector(["ngCookies"]).invoke(["$cookies",function(a){b=a}]),a.useSanitizeValueStrategy("sanitize");var c=b.get("language");void 0==c&&(c="en"),a.preferredLanguage(c),a.useLoader("i18nLoader")}),a.run(function(a){}),a.factory("i18nLoader",function(a,b,c){return function(d){var e=b.defer();return a.get(c.basePath+"/@front/labels/"+d.key).then(function(a){e.resolve(a.data)}).catch(function(a){console.log(a.status),console.log(a),e.reject(d.key)}),e.promise}})}(),function(){angular.module("backApp").controller("BlockManagementCtrl",function(a,b,c){a.init=function(a,b,d){c.init(a,b,d).then(function(){})}})}(),function(){angular.module("backApp").controller("BlockSelectionCtrl",function(a,b){b.init().then(function(){b.initTemplates().then(function(){a.templates=b.getTemplates()}),b.initLangs().then(function(){a.langs=b.getLangs()}),a.currentLang="",a.switchLang=function(b){a.currentLang=b},a.openValue=!1,a.switchDisplay=function(){a.openValue=!a.openValue}})})}(),function(){angular.module("backApp").controller("ModalDemoCtrl",function(a,b,c){a.items=["item1","item2","item3"],a.open=function(d){var e,f=a.$new();f.ok=function(){e.close(f.selected)},f.cancel=function(){e.dismiss("cancel")},e=b.open({template:"<my-modal></my-modal>",size:d,scope:f}),e.result.then(function(b){a.selected=b},function(){c.info("Modal dismissed at: "+new Date)})}})}(),function(){angular.module("backApp").controller("TemplateModalCtrl",function(a,b,c,d,e,f){a.exist=function(){return f.getExist(e.context,d.kind,d.path,d.name).then(function(b){a.scriptExist={exist:b,path:'"...'+d.path+"/"+d.name+'.jsp"'}})},a.cancel=function(){b.dismiss("cancel")},a.updateTemplate=function(c){c.$valid?f.saveTemplate(d).then(function(a){b.close(a)}).catch(function(b){a.template.errors=b}).finally(function(){}):b.dismiss("cancel")},a.template={templateModal:c.URL_TEMPLATE_MODAL,template:d,errors:null},a.exist()})}(),function(){angular.module("backApp").controller("UiPositionCtrl",function(a,b,c,d,e,f){c.init().then(function(){a.debug=!1,a.folder=c.getFolder(),a.page=c.getPage(),a.activeObject=c.getActiveObject(),e.getBlocksForModelPosition(a.modelId,a.page.id,a.activeObjectId,a.positionId).then(function(b){a.blocks=b}),d.getTemplate(a.modelId).then(function(b){a.model=b});var g=null==a.activeObject?"":a.activeObject.id;a.getParsedBlock=function(b){return f.serverRest+"/parsedblock/"+a.page.id+"/"+b.idMapTemplate+"/"+g+"?folderId="+a.folder.id},a.$on("dropEvent_"+a.positionId+"@"+a.modelId,function(d,e,h){console.log(a.modelId),console.log(a.positionId+"@"+a.modelId,a.page,e,h);var i=function(b){var d=null;"ACTIVEMODEL"==b?d=a.modelId:"ACTIVEPAGE"==b?d=a.page.id:"ACTIVEOBJECT"==b&&(d=g),console.log(d),c.setMapBlock(d,e.id,a.positionId,h).then(function(b){h<0?a.blocks.splice(0,0,b):a.blocks.push(b)})};if(console.log(a.model.kind),"PAGEBLOCK"==a.model.kind)i("ACTIVEMODEL");else{var j=null==a.activeObject;console.log(j),b.open({templateUrl:f.URL_TEMPLATE_MODAL_CHOICE_SCOPE,size:"sm",resolve:{buttons:function(){return{activeModel:!0,activePage:!0,activeObject:!j}},nbCol:function(){return j?2:3}},controller:function(a,b,c,d){a.buttons=c,a.classCol="col-xs-"+12/d,a.scopeActiveModel=function(){b.close("ACTIVEMODEL")},a.scopeActivePage=function(){b.close("ACTIVEPAGE")},a.scopeActiveObject=function(){b.close("ACTIVEOBJECT")}}}).result.then(function(a){i(a)})}}),a.remove=function(b){c.removeMapBlock(a.blocks[b].idMapTemplate).then(function(c){a.blocks.splice(b,1)})},a.open=function(c){b.open({templateUrl:f.URL_TEMPLATE_MODAL_EDIT,controller:"TemplateModalCtrl",size:"lg",resolve:{template:function(){return c},page:function(){return a.page}}}).result.then(function(a){templates})}})})}(),function(){var a=angular.module("backApp");a.directive("drag",["$rootScope",function(a){function b(a,b,c){b.addClass(c)}function c(a,b,c){b.removeClass(c)}return{restrict:"A",link:function(d,e,f){f.$set("draggable","true"),d.dragStyle=f.dragstyle,e.bind("dragstart",function(c){a.draggedElement=d[f.drag],b(c,e,d.dragStyle)}),e.bind("dragend",function(a){c(a,e,d.dragStyle)})}}}]),a.directive("drop",["$rootScope",function(a){function b(a,b,c){a.preventDefault(),b.addClass(c)}function c(a,b,c){b.removeClass(c)}function d(a){a.preventDefault()}function e(a,b,c){a.preventDefault(),b.removeClass(c)}return{restrict:"A",link:function(f,g,h){f.dropStyle=h.dropstyle,g.bind("dragenter",function(a){b(a,g,f.dropStyle)}),g.bind("dragleave",function(a){c(a,g,f.dropStyle)}),g.bind("dragover",d),g.bind("drop",function(b){e(b,g,f.dropStyle);var c=0;"top"==h.drop?c=-1:"bottom"==h.drop&&(c=-1);var d="dropEvent_"+f.positionId+"@"+f.modelId;a.$broadcast(d,a.draggedElement,c)})}}}]),a.directive("uiPosition",function(a,b){return{scope:{positionId:"@",modelId:"@",activeObjectId:"@"},restrict:"E",templateUrl:a.tplPath+"/ui-position.html",controller:"UiPositionCtrl",link:function(a,b,c){}}}),a.directive("myModal",function(){return{restrict:"E",templateUrl:"myModalContent.html",controller:function(a){a.selected={item:a.items[0]}}}})}(),function(a){"use strict";a.module("backApp").provider("backConfig",function(){var b={basePath:"",serverRest:"/@back",tplPath:"src/back/js/templates",i18nPath:"src/back/js/i18n"};return{$get:function(){return b},set:function(c){a.extend(b,c)}}})}(angular),function(){var a=angular.module("backServices",[]);a.config(function(a){a.interceptors.push("Interceptor")}),a.factory("Interceptor",function(a){return{responseError:function(b){return 404===b.status?(b.data='<div class="bg-danger"><h2>Object not found</h2><p>'+b.config.url+"</p></div>",a.resolve(b)):a.reject(b)}}})}(),function(){var a=angular.module("backServices");a.service("BlockManagementService",function(a,b,c,d,e,f,g,h,i){var j=null,k=null,l=null;self=this,self.getFolder=function(){return j},self.getPage=function(){return k},self.getActiveObject=function(){return l};var m=null;self.getTemplates=function(){return m};var n=null;self.getLangs=function(){return n},self.initFolder=function(a){var d=b.defer();return j?d.resolve():(console.log("init folder"),c.getFolder(a).then(function(a){console.log("folder initialized"),j=a,d.resolve()})),d.promise},self.initPage=function(a){var c=b.defer();return k?c.resolve():(console.log("init page"),d.getPage(a).then(function(a){console.log("page initialized"),k=a,c.resolve()})),c.promise},self.initActiveObject=function(a){var c=b.defer();return l?c.resolve():a?i.getTObject(a).then(function(a){l=a,console.log(l),c.resolve()}):c.resolve(),c.promise},self.initTemplates=function(){var a=b.defer();return m?a.resolve():e.getTemplates().then(function(b){m=b,a.resolve()}),a.promise},self.initLangs=function(){var a=b.defer();return n?a.resolve():f.getLangs().then(function(b){n=b,a.resolve()}),a.promise};var o=b.defer();self.init=function(a,c,d){return a&&c&&(console.log("init"),b.all([self.initFolder(a),self.initPage(c),self.initActiveObject(d)]).then(function(){}).catch(function(a){console.log(a),o.reject()}).finally(function(){console.log("fin init"),o.resolve()})),o.promise},self.setMapBlock=function(a,c,d,e){var f={modelId:a,blockId:c,positionId:d,ordered:e},g=b.defer();return h.save(f).then(function(a){g.resolve(a)}),g.promise},self.removeMapBlock=function(a){var c=b.defer();return h.remove(a).then(function(a){c.resolve(a)}),c.promise}}),a.service("TemplateService",function(a,b){self=this,self.getTemplate=function(b){return a.get({id:b}).$promise},self.getTemplates=function(){return a.getAll().$promise},self.getExist=function(a,c,d,e){return b.exist(a,c,d,e)},self.saveTemplate=function(b){return(b.id?a.update:a.create).call(a,{},b).$promise}}),a.service("LangService",function(a){self=this,self.getLang=function(b){return a.get({id:b}).$promise},self.getLangByCode=function(b){return a.get({code:b}).$promise},self.getLangs=function(){return a.getAll().$promise}}),a.service("FolderService",function(a){self=this,self.getFolder=function(b){return a.get({id:b}).$promise},self.getFolderByName=function(b){return a.get({name:b}).$promise},self.getFolders=function(){return a.getAll().$promise}}),a.service("PageService",function(a){self=this,self.getPage=function(b){return a.get({id:b}).$promise},self.getPages=function(){return a.getAll().$promise}}),a.service("BlockService",function(a){self=this,self.getBlocksForModelPosition=function(b,c,d,e){return a.getAll({modelId:b,pageId:c,activeObjectId:d,positionId:e}).$promise}}),a.service("MapTemplateService",function(a){self=this,self.save=function(b){return(b.id?a.update:a.save).call(a,{},b).$promise},self.remove=function(b){return a.remove({id:b}).$promise}}),a.service("TObjectService",function(a){self=this,self.getTObject=function(b){return a.get({id:b}).$promise}})}(),function(){angular.module("backServices").constant("$backjPath",{URL_SERVER_REST:"/neutrino/",URL_TEMPLATE_JS:"/neutrino/resources/src/back/js/templates/",URL_TEMPLATE_MODAL:"/neutrino/resources/src/back/js/templates/templateForm.html",URL_TEMPLATE_MODAL_ADD:"/neutrino/resources/src/back/js/templates/modalTemplateFormAdd.html",URL_TEMPLATE_MODAL_EDIT:"/neutrino/resources/src/back/js/templates/modalTemplateFormEdit.html",URL_TEMPLATE_MODAL_CHOICE_SCOPE:"/neutrino/resources/src/back/js/templates/choiceScopeModal.html"})}(),function(){var a=angular.module("backServices");a.factory("TemplateRepository",function(a,b){return{exist:function(c,d,e,f){return a.get(b.serverRest+"/templates/exist/",{params:{context:c,kind:d,path:e,name:f}}).then(function(a){return a.data}).catch(function(a){console.log(a.status),console.log(a)})}}}),a.factory("TemplateResource",function(a,b){return a(b.serverRest+"/template",{id:"@id"},{create:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("LangResource",function(a,b){return a(b.serverRest+"/lang",{id:"@id",code:"@code"},{create:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("FolderResource",function(a,b){return a(b.serverRest+"/folder",{id:"@id",name:"@name"},{create:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("PageResource",function(a,b){return a(b.serverRest+"/page",{id:"@id"},{create:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("BlockResource",function(a,b){return a(b.serverRest+"/block",{modelId:"@modelId",pageId:"@pageId",activeObjectId:"@activeObjectId",positionId:"@positionId"},{create:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("MapTemplateResource",function(a,b){return a(b.serverRest+" /mapTemplate",{id:"@id"},{save:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("TObjectResource",function(a,b){return a(b.serverRest+" /tobject",{id:"@id"},{save:{method:"POST"},get:{method:"GET"},getAll:{method:"GET",isArray:!0},remove:{method:"DELETE"},update:{method:"PUT"}})}),a.factory("PositionRepository",function(a,b){return{get:function(c){return a.get(b.serverRest+"/positions/"+c).then(function(a){return a.data}).catch(function(a){console.log(a.status),console.log(a)})},getAll:function(){return a.get(b.serverRest+"/positions/").then(function(a){return a.data}).catch(function(a){console.log(a.status),console.log(a)})}}}),a.factory("MapTemplateRepository",function(a,b){return{remove:function(c){return a.delete(b.serverRest+"/removemapblock/"+c).then(function(a){}).catch(function(a){console.log(a.status),console.log(a)})},add:function(c){return a.post(b.serverRest+"/addmapblock",c).then(function(a){return a.data}).catch(function(a){console.log(a.status),console.log(a)})}}})}();